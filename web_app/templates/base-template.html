<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
        var csrf = '{{generate_csrf_token() }}';
        var new_registrant_user_id = '';
    </script>
    {% if not global_vars.GA_TRACKING_CODE is none %}
      <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-99596173-4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '{{ global_vars.GA_TRACKING_CODE }}');
    </script>
    {% endif %}

    {% if not global_vars.ADSENSE_PAGELEVEL_CODE is none %}
    {{ global_vars.ADSENSE_PAGELEVEL_CODE|safe }}
    {% endif %}


    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    {% if not page.excerpt is none %}
    <meta name="description" content="{{ page.excerpt }}">
    {% else %}
    <meta name="description" content="{{ global_vars.DESCRIPTION }}">
    {% endif %}
    <meta name="author" content="">
    <link rel="icon" href="/static/favicon.png">

    <title>{{ global_vars.SITE_NAME }} - {{ global_vars.SITE_TAGLINE }}</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/app.css">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">-->



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Overlock:400i" rel="stylesheet">

    {% if not og is none %}
    <meta property="og:url"                content="{{ og.url }}" />
    <meta property="og:type"               content="{{ og.type }}" />
    <meta property="og:title"              content="{{ og.title }}" />
    <meta property="og:description"        content="{{ og.description }}" />
    <meta property="og:image"              content="{{ og.image }}" />
    {% endif %}
    <style>
      .video-responsive iframe{
    left:0;
    top:0;
    height:100%;
    width:100%;
    position:absolute;
}

    </style>
  </head>

  <body>
    <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand brand visible-lg" href="/">{{ global_vars.SITE_NAME }}</a>
      <a class="navbar-brand brand hidden-lg" href="/"><img src="/static/logo.png"/> </a>
      <a class="navbar-brand brand hidden-lg" href="/">
        {% if page.category is none %}
        {{ global_vars.SITE_NAME }}
        {% else %}
        {{ page.category|capitalize }}
        {% endif %}
      </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        {% for menu in menus %}
        <li class="nav-item {% if global_vars.ACTIVE_MENU|lower == menu.page.title|lower %} active {% endif %}">
            <a href="/{{ menu.page.title|lower }}"  class="nav-link"><span class="glyphicon"></span>{{ menu.title }}
            <span class="sr-only">(current)</span></a>
        </li>
        {% endfor %}

        <!--<li class="dropdown">-->
          <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown">Profile <span class="caret"></span></a>-->
          <!--<ul class="dropdown-menu" role="menu">-->
            <!--<li><a href="/admin" target="_blank">Admin</a></li>-->
            <!--<li><a href="#">Another action</a></li>-->
            <!--<li><a href="#">Something else here</a></li>-->
            <!--<li class="divider"></li>-->
            <!--<li><a href="#">Separated link</a></li>-->
            <!--<li class="divider"></li>-->
            <!--<li><a href="#">One more separated link</a></li>-->
          <!--</ul>-->
        <!--</li>-->
      </ul>

      <!--<form class="navbar-form navbar-left" role="search">-->
        <!--<div class="form-group">-->
          <!--<input type="text" class="form-control" placeholder="Search">-->
        <!--</div>-->
        <!--<button type="submit" class="btn btn-default">Submit</button>-->
      <!--</form>-->
      {% if global_vars.SHOW_REGISTRATION_MENU == True  %}
      <ul class="nav navbar-nav navbar-right">
        {% if current_user.is_authenticated %}
        <li class="dropdown">
        <a class="dropdown-toggle glyphicon glyphicon-user" data-toggle="dropdown" href="#"> {{ current_user.username }}
        <span class="caret"></span></a>
        <ul class="dropdown-menu">
          {% if current_user.has_role('admin') %}
          <li><a href="/admin" target="_blank">Admin</a></li>
          {% endif %}
          <li><a href="/logout">Logout</a></li>
        </ul>
      </li>

        {% endif %}

      </ul>
      {% endif %}
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12 col-md-8">
  {% if not global_vars.ADSENSE_HEADER is none %}
  {{ global_vars.ADSENSE_HEADER | safe}}
  {% endif %}
        </div>
      </div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12 col-md-8">
        {{ content|safe }}
        </div>

{% if not global_vars.ADSENSE_FOOTER is none %}
        <div class="row">
          <div class="col-xs-12 col-md-8" align="center">
  {{ global_vars.ADSENSE_FOOTER | safe}}
  {% endif %}
          </div>
        </div>
      </div>
    </div><!-- /.container -->

  <div class="navbar navbar-default navbar-fixed-bottom" style="border: 0;">
    <div class="container">
      {% if not current_user.is_authenticated %}
      <div class="row">
        <div class="col-xs-12 col-md-8">
          <!--<a href="{{ url_for_security('register') }}{% if 'next' in request.args %}?next={{ request.args.next|urlencode }}{% endif %}" class="navbar-btn btn-success btn center-block">-->
          <!--Jadilah 100 Nezzers pertama!</a>-->

            <!--<div class="form-group row">-->
                <!--<input value="+62" id="fb_country_code" class="form-control"/>-->
                <!---->
                <!--<button onclick="smsLogin();" class="btn btn-primary">Login</button>-->
            <!--</div>-->

           <div class="input-group">
                <input placeholder="Login dengan nomor HP disini" id="login_phone_or_email" class="form-control"/>
                <span class="input-group-btn">
                    <button class="btn btn-default value-control" id="btn_login_phone_or_email">
                    <span class="glyphicon glyphicon-log-in"></span>
                </button>
                </span>
            </div>

        </div>


            <!--<form>-->
  <!--<div class="form-group">-->


            <!--<div>OR</div>-->
            <!--<input placeholder="email" id="fb_email"/>-->
            <!--<button onclick="emailLogin();">Login via Email</button>-->
  <!--</div>-->
            <!--</form>-->

        </div>
      </div>
      {% else %}
        {% if page.subtype == 'page' %}
      <div class="row">
        <div class="col-xs-12 col-md-8">
          <div class="input-group">
            <input id="comment-box" class="form-control custom-control" rows="1" style="resize:none" placeholder="Tekan enter disini untuk berkomentar"></input>
              {% if loved is defined %}
                {% if loved %}
                <span id="button-of-love" class="glyphicon input-group-addon glyphicon-heart"></span>
                {% else %}
                <span id="button-of-love" class="glyphicon input-group-addon glyphicon-heart-empty"></span>
                {% endif %}
              {% endif %}
            <!--<span id="button-of-speak" class="glyphicon glyphicon-plus input-group-addon" style="color:white; background:blue"></span>-->
          </div>
        </div>
      </div>
        {% else %}
        <div class="row">
        <div class="col-xs-12 col-md-8">
            <p class="navbar-btn btn-success btn center-block">
            Nikmati harimu {{ current_user.username }}! <span class="fa fa-smile"></span>
            </p>
        </div>
        </div>
        {% endif %}
      {% endif %}
    </div>

    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">NezzMedia</h4>
          </div>
          <div class="modal-body">
            <div class="input-group">
                <input placeholder="Hai, masukkan namamu ya" id="new_registrant_username" class="form-control"/>
                <span class="input-group-btn">
                    <button class="btn btn-default value-control" id="btn_new_registrant_username">
                    <span class="glyphicon glyphicon-log-in"></span>
                </button>
                </span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>-->
    <script src="/static/pinterestpage/js/grid.js"></script>
    <script src="https://sdk.accountkit.com/en_US/sdk.js"></script>
  <script>
$(document).ready(function() {
$('#pinBoot').pinterest_grid({
no_columns: 4,
padding_x: 10,
padding_y: 10,
margin_bottom: 50,
single_column_breakpoint: 700
});
});
</script>
    </div><!--container fluid -->

    {% if current_user.is_authenticated %}
<script>
  $('#myModal').modal({ show: false});
  $('#button-of-love').on('click', function (e) {
    $.ajax({
         type: "PUT",
         url: "/api/loves",
         data: {'page_id': {{ page.id }}, 'user_id': {{ current_user.id }}},
         dataType: "json",
         success: function (data, status, jqXHR) {
                data = JSON.parse(data);
             if(data.loved){
                console.log('to loved');
                $('#button-of-love').removeClass('glyphicon-heart-empty');
                $('#button-of-love').addClass('glyphicon-heart');
             }else{
                console.log('to unloved');
                $('#button-of-love').removeClass('glyphicon-heart');
                $('#button-of-love').addClass('glyphicon-heart-empty');
             }
         },

         error: function (jqXHR, status) {
             console.log(jqXHR);

         }
     });
  });
</script>
<script>
  $('#comment-box').keypress(function (e) {
    comment = $('#comment-box').val();
    if(comment != ''){
      if (e.which == 13) {

        // start commenting
        $("#comment-box").prop('disabled', true);
        $.ajax({
             type: "PUT",
             url: "/api/comments",
             data: {'page_id': {{ page.id }},
                    'user_id': {{ current_user.id }},
                    'comment': comment },
             dataType: "json",
             success: function (data, status, jqXHR) {
                    data = JSON.parse(data);
                 if(data.success){
                    $("#comment-box").val('');
                    $("#comment-box").prop('disabled', false);
                    console.log('commenting by');
                    console.log(data);
                    var id_newcomment = "new-comment-" + data.id;
                    new_comment = '<p id="' + id_newcomment + '"><a href="#">' + data.username + '</a> ' + data.comment + '</p>';
                    $("#new-comment").append(new_comment);
                    $('body, html').animate({ scrollTop: $("#" + id_newcomment).offset().top }, 1000);

                 }else{
                    // enabled, allow retry
                    $("#comment-box").prop('disabled', false);
                 }
             },

             error: function (jqXHR, status) {
                 console.log(jqXHR);
                 //retry
             }
         });
        // catch result


        return false;
      }
    }
  });
</script>
    {% else %}

  {% endif %}
    <script>

        function validate_email(email) {
          var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
          return re.test(email);
        }

        AccountKit_OnInteractive = function(){
            AccountKit.init(
              {
                appId:"303680430123651",
                state: csrf,
                version:"v1.1",
                fbAppEventsEnabled:true,
                redirect:"/"
              });
        };

        $("#login_phone_or_email").keyup(function(event) {
            if (event.keyCode === 13) {
                $("#btn_login_phone_or_email").click();
            }
        });

        $('#btn_new_registrant_username').on('click', function (e) {
            var username = $('#new_registrant_username').val();
            // send username to backend for the current user
            $.ajax({
                type: "POST",
                url: "/api/accountkit",
                data: {'username': username, 'user_id': new_registrant_user_id},
                dataType: "json",
                success: function (data, status, jqXHR) {
                data = JSON.parse(data);
                if(data.success){
                    location.reload();
                 }else{
                    console.log('Not success after partial');
                 }
                },

                error: function (jqXHR, status) {
                 console.log(jqXHR);
                 //retry
                }
            });

        });

        $("#new_registrant_username").keyup(function(event) {
            username = $('#new_registrant_username').val();
            allow_pass = username.trim().length >= 3;

            if (allow_pass && event.keyCode === 13) {
                $("#btn_new_registrant_username").click();
            }

            if(allow_pass){
                $("#btn_new_registrant_username").prop('disabled', false);
            }else{
                $("#btn_new_registrant_username").prop('disabled', true);
            }

        });

        $('#btn_login_phone_or_email').on('click', function (e) {
            var phone_or_email = $('#login_phone_or_email').val();
            console.log(phone_or_email);
            if(phone_or_email != '')
            {
                login_type = '';
                if(validate_email(phone_or_email)){
                    login_type = 'EMAIL';
                    payload = {emailAddress: phone_or_email}
                    console.log(payload);
                }else {
                    login_type = 'PHONE';
                    var country_code = '';

                    if(!phone_or_email.startsWith('+')){
                        country_code = '+62';
                    } else {
                        country_code = phone_or_email.substr(0, 3); // TODO: problem with country code not 3 in length
                        phone_or_email = phone_or_email.substr(3, phone_or_email.length);
                    }
                    payload = {countryCode: country_code, phoneNumber: phone_or_email};
                    console.log(payload);
                }

                AccountKit.login(
                    login_type,
                    payload,
                    loginCallback
                );
            }
        });

        function loginCallback(response) {
            console.log('callback?');
            if (response.status === "PARTIALLY_AUTHENTICATED") {
              console.log('PARTIALLY_AUTHENTICATED');
              var code = response.code;
              var _csrf = response.state;

              if(_csrf === csrf){
                  $.ajax({
                     type: "PUT",
                     url: "/api/accountkit",
                     data: {'code': code},
                     dataType: "json",
                     success: function (data, status, jqXHR) {
                        data = JSON.parse(data);
                        console.log(data);
                        if(data.success){
                            if(data.new_registrant){
                                console.log('New registrant is here');
                                console.log(data)
                                new_registrant_user_id = data.user_id
                                $('#myModal').modal({backdrop: 'static', keyboard: false});
                            }
                         }else{
                            console.log('Not success after partial');
                         }
                     },

                     error: function (jqXHR, status) {
                         console.log(jqXHR);
                         //retry
                     }
                 });
              }else{
                alert('Not authenticated!');
              }
            }
            else if (response.status === "NOT_AUTHENTICATED") {
                console.log('NOT_AUTHENTICATED');
            }
            else if (response.status === "BAD_PARAMS") {
              console.log('BAD_PARAMS');
            }
        }
    </script>

  <script>
      $('#right_nav').on('click', function (e) {
        console.log('right');
      });
  </script>
